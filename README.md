# Grid-based Location Search App with Enhanced Email Extraction

Streamlit을 활용한 격자 기반 위치 검색 웹 애플리케이션입니다. Google Places API의 한 번에 20개 결과 제한을 극복하기 위해 검색 범위를 격자로 나누어 더 많은 결과를 얻을 수 있도록 설계되었습니다. **향상된 이메일 추출 기능**으로 다양한 방법을 통해 웹사이트에서 이메일을 수집할 수 있습니다.

## 🚀 주요 기능

- **격자 기반 검색**: 검색 범위를 NxN 격자로 나누어 각 격자별로 독립적인 검색 수행
- **다중 키워드 검색**: 여러 키워드를 동시에 검색하여 포괄적인 결과 제공
- **🆕 향상된 이메일 추출**: 
  - 표준 이메일 패턴 감지
  - 난독화된 이메일 디코딩 (`email[at]domain[dot]com`, `email(at)domain(dot)com`)
  - JavaScript 코드에서 이메일 추출
  - 연락 양식의 action 속성에서 이메일 발견
  - 숨겨진 입력 필드 및 데이터 속성 검색
  - HTML 주석 내부 이메일 검색
  - 30자 초과 암호화된 이메일 자동 제외
  - 가짜/테스트 이메일 필터링
- **인터랙티브 지도**: Folium을 활용한 검색 결과 시각화 (이메일 발견 장소 구분)
- **실시간 필터링**: 키워드별, 이메일 유무별 필터링 및 정렬 기능
- **데이터 내보내기**: 검색 결과 및 이메일 목록을 CSV 파일로 다운로드
- **통계 대시보드**: 검색 결과 및 이메일 추출 통계 정보 제공

## 🛠️ 설치 및 실행

### 1. 의존성 설치

```bash
pip install -r requirements.txt
```

### 2. Google Places API 키 발급

1. [Google Cloud Console](https://console.cloud.google.com/)에서 프로젝트 생성
2. Places API 활성화
3. API 키 생성 및 Places API에 대한 권한 설정
4. API 키에 적절한 제한사항 설정 (보안을 위해)

### 3. 애플리케이션 실행

```bash
streamlit run app.py
```

## 📖 사용법

### 1. 기본 설정

**사이드바에서 다음 정보를 입력하세요:**

- **중심점 설정**: 검색할 중심 위치의 위도, 경도
- **검색 반지름**: 중심점에서 검색할 반지름 (km 단위)
- **검색 키워드**: 찾고자 하는 장소들의 키워드 (줄바꿈으로 구분)
- **격자 설정**: 검색 범위를 나눌 격자 크기 (2x2 ~ 6x6)
- **🆕 이메일 추출**: 웹사이트에서 이메일을 추출할지 선택
- **API Key**: Google Places API 키

### 2. 격자 검색 원리

```
원본 검색 범위 (5km)     →     3x3 격자로 분할
┌─────────────────┐             ┌───┬───┬───┐
│                 │             │ 1 │ 2 │ 3 │
│                 │             ├───┼───┼───┤
│        ●        │      →      │ 4 │ ● │ 6 │
│    (중심점)      │             ├───┼───┼───┤
│                 │             │ 7 │ 8 │ 9 │
└─────────────────┘             └───┴───┴───┘
```

- 각 격자에서 개별적으로 API 호출
- 20개 제한 × 9개 격자 = 최대 180개 결과 가능
- 중복 제거 및 원본 범위 내 결과만 필터링

### 3. 🆕 향상된 이메일 추출 과정

1. **Google Places API**: 장소 검색 및 웹사이트 URL 획득
2. **다중 페이지 크롤링**: 
   - 메인 페이지 (`/`)
   - 연락처 페이지 (`/contact`, `/contact-us`, `/contactus`)
   - 소개 페이지 (`/about`, `/about-us`, `/aboutus`)
   - 지원 페이지 (`/support`, `/help`, `/info`)
   - 기타 (`/inquiry`, `/customer-service`, `/feedback`)

3. **다양한 추출 방법**:
   - **표준 이메일**: `contact@domain.com`
   - **난독화 이메일**: `contact[at]domain[dot]com`, `info(at)company(dot)kr`
   - **JavaScript 내부**: 스크립트 태그 및 문자열 연결 패턴
   - **연락 양식**: `<form action="mailto:email@domain.com">`
   - **숨겨진 요소**: `<input type="hidden" value="email@domain.com">`
   - **HTML 주석**: `<!-- Contact: email@domain.com -->`

4. **스마트 필터링**:
   - 30자 초과 이메일 자동 제외
   - 가짜 이메일 패턴 제거 (`test@test.com`, `admin@admin.com`)
   - 비즈니스 이메일 우선순위 정렬

### 4. 결과 확인

검색 완료 후 4개 탭에서 결과를 확인할 수 있습니다:

- **🗺️ 지도**: 검색 결과를 지도에 마커로 표시 (🔵 일반, 🟢 이메일 발견)
- **📊 결과 테이블**: 상세 정보를 표 형태로 제공, 이메일 필터링 가능
- **📧 이메일 정보**: 추출된 이메일 정보를 상세히 확인 및 별도 다운로드
- **📈 통계**: 키워드별 분포, 평점 분포, 이메일 추출 통계

## 🏗️ 프로젝트 구조

```
extract/
├── app.py                 # Streamlit 메인 애플리케이션
├── backend/              
│   ├── __init__.py       
│   ├── config.py         # API 설정 관리
│   ├── grid_calculator.py # 격자 계산 로직
│   ├── places_api.py     # Google Places API 클라이언트
│   ├── search_engine.py  # 메인 검색 엔진
│   └── email_extractor.py # 🆕 향상된 이메일 추출 엔진
├── requirements.txt      # Python 의존성
├── demo.py              # 백엔드 로직 테스트용 데모
└── README.md            # 프로젝트 문서
```

## 🔧 격자 크기별 특성

| 격자 크기 | API 호출 수 | 예상 최대 결과 | 검색 시간 | 추천 용도 |
|---------|------------|-------------|----------|----------|
| 2x2     | 4 × 키워드수 | ~80개      | 빠름      | 빠른 검색 |
| 3x3     | 9 × 키워드수 | ~180개     | 보통      | 균형잡힌 검색 |
| 4x4     | 16 × 키워드수 | ~320개     | 느림      | 상세한 검색 |
| 5x5     | 25 × 키워드수 | ~500개     | 매우 느림  | 포괄적인 검색 |

## 📧 이메일 추출 성능

### 지원하는 이메일 형태
- ✅ `contact@domain.com` (표준)
- ✅ `info[at]company[dot]com` (난독화)
- ✅ `support(at)business(dot)kr` (난독화)
- ✅ `admin @ website . org` (공백 포함)
- ✅ JavaScript 문자열 연결: `"contact" + "@" + "domain.com"`
- ✅ 연락 양식 action 속성
- ✅ 숨겨진 입력 필드 및 데이터 속성

### 자동 제외되는 이메일
- ❌ 30자 초과 이메일
- ❌ `test@test.com`, `admin@admin.com` (가짜 패턴)
- ❌ `noreply@`, `no-reply@` (응답 불가)
- ❌ 숫자 70% 이상 포함 (생성된 이메일)

## ⚠️ 주의사항

1. **API 사용량**: 격자 크기와 키워드 수에 따라 API 호출 횟수가 기하급수적으로 증가
2. **이메일 추출 시간**: 웹사이트 크롤링으로 인해 상당한 시간이 소요될 수 있음
3. **Rate Limiting**: API 호출 간 지연시간을 두어 rate limit 방지
4. **비용**: Google Places API는 사용량에 따라 과금되므로 주의 필요
5. **API 키 보안**: API 키를 공개 저장소에 노출하지 않도록 주의
6. **이메일 수집 윤리**: 웹사이트의 robots.txt 및 이용약관을 준수하세요

## 🎯 활용 사례

- **상권 분석**: 특정 지역의 카페, 음식점 등 업종별 분포 및 연락처 조사
- **B2B 마케팅**: 경쟁업체 및 잠재 고객 이메일 수집
- **부동산 분석**: 편의시설(편의점, 약국, 병원 등) 접근성 및 연락처 평가  
- **지역 비즈니스 디렉토리**: 특정 지역 사업체 목록 및 연락처 구축
- **마케팅 리서치**: 시장 포화도 분석 및 연락 가능한 사업체 파악

## 🔮 향후 개선 계획

- [ ] 비동기 API 호출로 성능 최적화
- [ ] 다양한 지도 서비스 API 지원 (Naver, Kakao 등)
- [ ] 검색 결과 캐싱 기능
- [ ] 더 정교한 격자 분할 알고리즘
- [ ] 검색 이력 저장 및 관리 기능
- [ ] 이메일 검증 API 연동
- [ ] 소셜 미디어 링크 추출 기능 